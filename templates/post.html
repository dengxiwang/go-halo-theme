<!doctype html>
<html
  xmlns:th="https://www.thymeleaf.org"
  th:replace="~{modules/layout :: html(
        title = ${post.spec.title} + ' - ' + ${site.title},
        contentBefore = ~{::contentBefore},
        content = ~{::content},
        )}"
>
  <!-- 文章标题信息 -->
  <th:block th:fragment="contentBefore">
    <th:block th:replace="~{modules/components/postTitle}" />
  </th:block>

  <!-- 文章具体内容 -->
  <th:block th:fragment="content">
    <div
      class="max-md:block"
      th:classappend="${(theme.config.post.showPostImgs == true and !#lists.isEmpty(theme.config.post.postImgs)) or #strings.contains(post.content.content, '<h') ? 'grid gap-2' : ''}"
      style="grid-template-columns: 1fr 15rem"
    >
      <div class="h-auto flex-1 overflow-hidden rounded-lg border bg-white p-6 max-md:p-4 max-sm:p-3">
        <!-- 内容 -->
        <article
          id="content"
          class="markdown-body !max-w-none break-words"
          th:utext="${post.content.content}"
        ></article>
      </div>

      <!-- 右侧区域 -->
      <div
        th:if="${(theme.config.post.showPostImgs == true and !#lists.isEmpty(theme.config.post.postImgs)) or #strings.contains(post.content.content, '<h')}"
        class="space-y-2 max-md:hidden"
      >
        <div
          class="sticky space-y-2"
          th:classappend="${#lists.isEmpty(menuFinder.getPrimary.menuItems) && theme.config.header.showSearch == false && theme.config.header.showLogo == false && theme.config.header.showTitle == false ? 'top-4' : 'top-20'}"
        >
          <!-- 目录 -->
          <div
            th:if="${#strings.contains(post.content.content, '<h')}"
            class="toc-container h-0 w-60 overflow-hidden rounded-lg border bg-white p-3 opacity-0 transition-all duration-300"
            style="font-size: 0"
          >
            <div class="mb-2 flex items-center justify-between">
              <h3 class="ml-1 text-base font-medium">文章目录</h3>
            </div>
            <div id="toc" class="toc"></div>
          </div>

          <!-- 图片列表 -->
          <div
            th:if="${theme.config.post.showPostImgs == true and !#lists.isEmpty(theme.config.post.postImgs)}"
            th:with="images = ${theme.config.post.postImgs}"
            class="w-60 space-y-2 overflow-hidden opacity-0 transition-all duration-300 *:rounded-lg *:border *:bg-white *:p-3"
            style="font-size: 0"
            id="sidebar-images"
          >
            <th:block th:each="item : ${images}">
              <!-- 只有当 img 存在时才渲染 -->
              <div th:if="${!#strings.isEmpty(item.img)}" class="text-center">
                <h4 class="mb-2 text-sm font-medium" th:text="${item.label}"></h4>
                <div class="w-full overflow-hidden rounded-md border">
                  <!-- 判断 url 是否存在，决定是否用 a 标签包裹 -->
                  <a
                    th:if="${!#strings.isEmpty(item.url)}"
                    th:href="${item.url}"
                    target="_blank"
                    rel="noopener"
                    class="block"
                  >
                    <img
                      th:src="${item.img}"
                      th:alt="${item.label}"
                      class="h-full w-full object-contain"
                      loading="lazy"
                    />
                  </a>
                  <!-- 如果没有 url，则直接显示 img -->
                  <img
                    th:if="${#strings.isEmpty(item.url)}"
                    th:src="${item.img}"
                    th:alt="${item.label}"
                    class="h-full w-full object-contain"
                    loading="lazy"
                  />
                </div>
              </div>
            </th:block>
          </div>
        </div>
      </div>
    </div>

    <!-- 标签导航 -->
    <th:block th:replace="~{modules/components/tags}"></th:block>

    <!-- 切换文章 -->
    <div
      class="flex flex-col gap-3 sm:flex-row sm:justify-between"
      th:with="postCursor = ${postFinder.cursor(post.metadata.name)}"
    >
      <!-- 上一篇 -->
      <div class="flex flex-1 justify-start" th:if="${postCursor.hasPrevious()}">
        <a
          role="navigation"
          class="group inline-flex items-center gap-1 truncate text-sm text-gray-600 hover:text-gray-900"
          th:href="@{${postCursor.previous.status.permalink}}"
          th:title="${postCursor.previous.spec.title}"
        >
          <!-- SVG 左箭头 -->
          <svg
            class="transition-transform duration-300 group-hover:-translate-x-0.5"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>

          <span th:text="|上一篇：${#strings.abbreviate(postCursor.previous.spec.title,20)}|"></span>
        </a>
      </div>

      <!-- 下一篇 -->
      <div class="flex flex-1 justify-end" th:if="${postCursor.hasNext()}">
        <a
          role="navigation"
          class="group inline-flex items-center gap-1 truncate text-sm text-gray-600 hover:text-gray-900"
          th:href="@{${postCursor.next.status.permalink}}"
          th:title="${postCursor.next.spec.title}"
        >
          <span th:text="|下一篇：${#strings.abbreviate(postCursor.next.spec.title,20)}|"></span>

          <!-- SVG 右箭头 -->
          <svg
            class="transition-transform duration-300 group-hover:translate-x-0.5"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </a>
      </div>
    </div>

    <!-- 评论组件 -->
    <div id="comment" th:if="${haloCommentEnabled}">
      <h2 class="mb-2 text-base font-medium">评论</h2>
      <halo:comment group="content.halo.run" kind="Post" th:attr="name=${post.metadata.name}" />
    </div>
  </th:block>
</html>
